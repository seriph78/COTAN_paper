<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>P0 cortex</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="html-md-01.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Documentation for COTAN paper</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Datasets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">E11.5 mouse cortex</li>
    <li>
      <a href="E13.5_cortex_analysis.nb.html">E13.5 mouse cortex</a>
    </li>
    <li class="dropdown-header">E15.5 mouse cortex</li>
    <li>
      <a href="E17.5_cortex_analysis.nb.html">E17.5 mouse cortex</a>
    </li>
    <li>
      <a href="Gene_clustering.nb.html">E17.5 gene clustering</a>
    </li>
    <li>
      <a href="General_heatmap.nb.html">E17.5 general heatmap</a>
    </li>
    <li>
      <a href="E14.5_cortex_analysis.nb.html">E14.5 mouse cortex</a>
    </li>
    <li>
      <a href="P0_cortex_analysis.nb.html">P0 mouse cortex</a>
    </li>
    <li>
      <a href="E16_analysis.nb.html">E16.5 mouse dentate gyrus</a>
    </li>
    <li class="dropdown-header">P0 mouse dentate gyrus</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Test
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Fig1_Seurat_corr_vs_cotan_heatmap.nb.html">Correlation vs COTAN coex</a>
    </li>
    <li>
      <a href="Loo_et_all_markers.nb.html">Comparision with Loo et al. markers</a>
    </li>
    <li>
      <a href="WGCNA_experiments.nb.html">WGCNA experiments</a>
    </li>
  </ul>
</li>
<li>
  <a href="Negative_dataset_analysis.nb.html">Negative dataset</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Others
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Execution_times.nb.html">Execution times</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">P0 cortex</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#analitical-pipeline"><span class="toc-section-number">0.1</span> Analitical pipeline</a></li>
<li><a href="#data-cleaning"><span class="toc-section-number">0.2</span> Data cleaning</a></li>
<li><a href="#analysis-of-the-elaborated-data"><span class="toc-section-number">0.3</span> Analysis of the elaborated data</a><ul>
<li><a href="#gdi"><span class="toc-section-number">0.3.1</span> GDI</a></li>
<li><a href="#heatmaps"><span class="toc-section-number">0.3.2</span> Heatmaps</a></li>
</ul></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(COTAN)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(data.table)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(Matrix)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; Loading required package: ggplot2</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#library(latex2exp)</span></a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">mycolours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span> =<span class="st"> &quot;#8491B4B2&quot;</span>,<span class="st">&quot;B&quot;</span>=<span class="st">&quot;#E64B35FF&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">my_theme =<span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span> ),</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">                 <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>),</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">                 <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="dv">0</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>),</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">                 <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> <span class="dv">14</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>))</a></code></pre></div>
<p>Download the dataset for mouse cortex P0.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">data_dir =<span class="st"> &quot;Data/Mouse2/&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">data =<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">fread</span>(<span class="kw">paste</span>(data_dir,<span class="st">&quot;GSE123335_P0_combined_matrix.txt.gz&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">data =<span class="st"> </span><span class="kw">as.data.frame</span>(data)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">rownames</span>(data) =<span class="st"> </span>data<span class="op">$</span>Gene</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">data =<span class="st"> </span>data[,<span class="dv">2</span><span class="op">:</span><span class="kw">ncol</span>(data)]</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">data[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["p0-WT2_AAAACATGAACC"],"name":[1],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAAAGACACCAC"],"name":[2],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAAAGGCTCGTG"],"name":[3],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAAATACGCAAG"],"name":[4],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACACCGGATA"],"name":[5],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACACCGGGCA"],"name":[6],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACAGGTCCGT"],"name":[7],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACCATCACTA"],"name":[8],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACCTACTCTT"],"name":[9],"type":["int"],"align":["right"]},{"label":["p0-WT2_AAACCTCATTTC"],"name":[10],"type":["int"],"align":["right"]}],"data":[{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","_rn_":"0610005C13Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","_rn_":"0610007N19Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"3","6":"0","7":"1","8":"0","9":"0","10":"0","_rn_":"0610007P14Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"1","9":"1","10":"0","_rn_":"0610009B22Rik"},{"1":"0","2":"0","3":"0","4":"1","5":"0","6":"1","7":"0","8":"0","9":"3","10":"1","_rn_":"0610009D07Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"2","9":"0","10":"0","_rn_":"0610009E02Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","_rn_":"0610009L18Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"1","9":"0","10":"0","_rn_":"0610009O20Rik"},{"1":"0","2":"3","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","_rn_":"0610010F05Rik"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","_rn_":"0610010K14Rik"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Define a directory where the ouput will be stored.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">out_dir =<span class="st"> &quot;Data/&quot;</span></a></code></pre></div>
<div id="analitical-pipeline" class="section level2">
<h2><span class="header-section-number">0.1</span> Analitical pipeline</h2>
<p>Inizialise the COTAN object with the row count table and the metadata for the experiment.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">obj =<span class="st"> </span><span class="kw">new</span>(<span class="st">&quot;scCOTAN&quot;</span>,<span class="dt">raw =</span> data)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">obj =<span class="st"> </span><span class="kw">initRaw</span>(obj,<span class="dt">GEO=</span><span class="st">&quot;GSE123335&quot;</span> ,<span class="dt">sc.method=</span><span class="st">&quot;10X&quot;</span>,<span class="dt">cond =</span> <span class="st">&quot;mouse cortex P0&quot;</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; [1] &quot;Initializing S4 object&quot;</span></a></code></pre></div>
<p>Now we can start the cleaning. Analysis requires and starts from a matrix of raw UMI counts after removing possible cell doublets or multiplets and low quality or dying cells (with too high mtRNA percentage, easily done with Seurat or other tools).</p>
<p>If we do not want to consider the mithocondrial genes we can remove them before starting the analysis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">genes_to_rem =<span class="st"> </span><span class="kw">rownames</span>(obj<span class="op">@</span>raw[<span class="kw">grep</span>(<span class="st">&#39;^mt&#39;</span>, <span class="kw">rownames</span>(obj<span class="op">@</span>raw)),]) <span class="co">#genes to remove : mithocondrial</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">obj<span class="op">@</span>raw =<span class="st"> </span>obj<span class="op">@</span>raw[<span class="op">!</span><span class="kw">rownames</span>(obj<span class="op">@</span>raw) <span class="op">%in%</span><span class="st"> </span>genes_to_rem,]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">cells_to_rem =<span class="st"> </span><span class="kw">colnames</span>(obj<span class="op">@</span>raw[<span class="kw">which</span>(<span class="kw">colSums</span>(obj<span class="op">@</span>raw) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)])</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">obj<span class="op">@</span>raw =<span class="st"> </span>obj<span class="op">@</span>raw[,<span class="op">!</span><span class="kw">colnames</span>(obj<span class="op">@</span>raw) <span class="op">%in%</span><span class="st"> </span>cells_to_rem]</a></code></pre></div>
<p>We want also to define a prefix to identify the sample.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">t =<span class="st"> &quot;P0_cortex&quot;</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Condition &quot;</span>,t,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [1] &quot;Condition P0_cortex&quot;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#--------------------------------------</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">n_cells =<span class="st"> </span><span class="kw">length</span>(<span class="kw">colnames</span>(obj<span class="op">@</span>raw))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;n cells&quot;</span>, n_cells, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>))</a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt; [1] &quot;n cells 7688&quot;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">n_it =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#obj@raw = obj@raw[rownames(cells), colnames(cells)]</span></a></code></pre></div>
</div>
<div id="data-cleaning" class="section level2">
<h2><span class="header-section-number">0.2</span> Data cleaning</h2>
<p>First we create the directory to store all information regardin the data cleaning.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(out_dir)){</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw">dir.create</span>(<span class="kw">file.path</span>(out_dir))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))){   </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="kw">dir.create</span>(<span class="kw">file.path</span>(out_dir, <span class="st">&quot;cleaning&quot;</span>))</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">}</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">ttm =<span class="st"> </span><span class="kw">clean</span>(obj)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Start estimation mu with linear method&quot;</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; [1] 14438  7688</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;        rowname p0-WT2_ACGAGCGATAGA p0-WT2_CAATCAGTTCAT p0-WT2_CAGTACCACATA</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; 8624       Npy          269.054089          260.832176          420.693732</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; 12065      Sst          102.371800           78.642867          102.935700</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; 13263   Tuba1a           18.374426            9.175001           19.393683</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; 7440    Malat1           36.748851            0.000000            1.491822</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 8551      Nnat           26.249179           18.350002           17.901861</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 7679      Meg3           26.249179            3.932143            0.000000</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 847       Actb           22.311802           13.107145           10.442752</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 2115     Calm1            6.562295            7.864287           13.426396</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 9101      Pcp4            0.000000            6.553572            5.967287</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt; 6352  Hsp90ab1            6.562295           19.660717            5.967287</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; 10893     Rtn1           11.812131           22.282146            4.475465</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 4921     Gap43            5.249836            7.864287           11.934574</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 5762      Gnas            1.312459           11.796430           13.426396</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 7530      Mapt            5.249836            5.242858           13.426396</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; 12890   Tmsb4x            7.874754            1.310714            4.475465</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt;       p0-WT2_TCAGCCAGGCAT p0-WT3_ACCAATCGACAG p0-WT3_ATCTCTTGCTGG</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; 8624           165.023143          198.814905          158.297051</span></a>
<a class="sourceLine" id="cb10-22" data-line-number="22"><span class="co">#&gt; 12065           87.365193           46.841208           47.659327</span></a>
<a class="sourceLine" id="cb10-23" data-line-number="23"><span class="co">#&gt; 13263           53.389840           11.450073           25.531782</span></a>
<a class="sourceLine" id="cb10-24" data-line-number="24"><span class="co">#&gt; 7440             0.000000           31.227472            6.808475</span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="co">#&gt; 8551            26.694920           14.572820           11.914832</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26"><span class="co">#&gt; 7679             0.000000           12.490989            0.000000</span></a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt; 847             24.268109           15.613736            8.510594</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"><span class="co">#&gt; 2115            12.134055            6.245494           18.723307</span></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="co">#&gt; 9101            19.414487           16.654652            0.000000</span></a>
<a class="sourceLine" id="cb10-30" data-line-number="30"><span class="co">#&gt; 6352             4.853622            7.286410           13.616951</span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="co">#&gt; 10893            7.280433            5.204579            6.808475</span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32"><span class="co">#&gt; 4921             4.853622           13.531905           17.021188</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33"><span class="co">#&gt; 5762             4.853622           10.409157            6.808475</span></a>
<a class="sourceLine" id="cb10-34" data-line-number="34"><span class="co">#&gt; 7530             4.853622            3.122747           11.914832</span></a>
<a class="sourceLine" id="cb10-35" data-line-number="35"><span class="co">#&gt; 12890            9.707244            1.040916           15.319069</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36"><span class="co">#&gt;       p0-WT3_GGATTGACAGGA p0-WT3_GTGAGATTCGAA p0-WT3_TACCGATCAAAG</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt; 8624           227.695969           89.091134          194.188936</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt; 12065           72.368486          189.604208           41.316795</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt; 13263           12.355595           31.981433           26.167303</span></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="co">#&gt; 7440             1.765085           41.118985           13.772265</span></a>
<a class="sourceLine" id="cb10-41" data-line-number="41"><span class="co">#&gt; 8551            24.711190           15.990716           15.149491</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42"><span class="co">#&gt; 7679             0.000000           38.834597           20.658397</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43"><span class="co">#&gt; 847             10.590510            9.137552           22.035624</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44"><span class="co">#&gt; 2115             3.530170           18.275104           15.149491</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="co">#&gt; 9101            17.650850            4.568776           19.281171</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="co">#&gt; 6352             7.060340            4.568776           12.395038</span></a>
<a class="sourceLine" id="cb10-47" data-line-number="47"><span class="co">#&gt; 10893            5.295255            4.568776            8.263359</span></a>
<a class="sourceLine" id="cb10-48" data-line-number="48"><span class="co">#&gt; 4921             8.825425            0.000000            5.508906</span></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"><span class="co">#&gt; 5762             5.295255           15.990716            4.131679</span></a>
<a class="sourceLine" id="cb10-50" data-line-number="50"><span class="co">#&gt; 7530             7.060340            2.284388            5.508906</span></a>
<a class="sourceLine" id="cb10-51" data-line-number="51"><span class="co">#&gt; 12890            8.825425            2.284388            0.000000</span></a>
<a class="sourceLine" id="cb10-52" data-line-number="52"><span class="co">#&gt;       p0-WT3_TGAGGAATGAGA p0-WT4_CCGCAAAGCACT p0-WT4_TCCTTTAACCTT</span></a>
<a class="sourceLine" id="cb10-53" data-line-number="53"><span class="co">#&gt; 8624           240.738358          175.421286          162.138055</span></a>
<a class="sourceLine" id="cb10-54" data-line-number="54"><span class="co">#&gt; 12065           78.379930           57.861471           58.467965</span></a>
<a class="sourceLine" id="cb10-55" data-line-number="55"><span class="co">#&gt; 13263           13.436560           25.716209           16.213806</span></a>
<a class="sourceLine" id="cb10-56" data-line-number="56"><span class="co">#&gt; 7440            23.513979           16.531849           37.340885</span></a>
<a class="sourceLine" id="cb10-57" data-line-number="57"><span class="co">#&gt; 8551             8.957706           33.063698           20.144425</span></a>
<a class="sourceLine" id="cb10-58" data-line-number="58"><span class="co">#&gt; 7679            15.675986           20.205593           21.127080</span></a>
<a class="sourceLine" id="cb10-59" data-line-number="59"><span class="co">#&gt; 847             10.077420           11.021233            9.335221</span></a>
<a class="sourceLine" id="cb10-60" data-line-number="60"><span class="co">#&gt; 2115            12.316846            3.673744            3.930620</span></a>
<a class="sourceLine" id="cb10-61" data-line-number="61"><span class="co">#&gt; 9101             2.239427            6.429052            4.913274</span></a>
<a class="sourceLine" id="cb10-62" data-line-number="62"><span class="co">#&gt; 6352            10.077420            5.510616            1.965310</span></a>
<a class="sourceLine" id="cb10-63" data-line-number="63"><span class="co">#&gt; 10893            6.718280            8.265924           10.809204</span></a>
<a class="sourceLine" id="cb10-64" data-line-number="64"><span class="co">#&gt; 4921             7.837993            5.510616            8.843894</span></a>
<a class="sourceLine" id="cb10-65" data-line-number="65"><span class="co">#&gt; 5762             2.239427            1.836872            5.404602</span></a>
<a class="sourceLine" id="cb10-66" data-line-number="66"><span class="co">#&gt; 7530             4.478853            8.265924            3.439292</span></a>
<a class="sourceLine" id="cb10-67" data-line-number="67"><span class="co">#&gt; 12890            5.598566           13.776541            9.335221</span></a>
<a class="sourceLine" id="cb10-68" data-line-number="68"><span class="co">#&gt;       p0-WT4_TCGTGGTCGTCA</span></a>
<a class="sourceLine" id="cb10-69" data-line-number="69"><span class="co">#&gt; 8624          260.0206889</span></a>
<a class="sourceLine" id="cb10-70" data-line-number="70"><span class="co">#&gt; 12065          65.6617901</span></a>
<a class="sourceLine" id="cb10-71" data-line-number="71"><span class="co">#&gt; 13263          14.8833391</span></a>
<a class="sourceLine" id="cb10-72" data-line-number="72"><span class="co">#&gt; 7440           59.5333564</span></a>
<a class="sourceLine" id="cb10-73" data-line-number="73"><span class="co">#&gt; 8551           14.0078486</span></a>
<a class="sourceLine" id="cb10-74" data-line-number="74"><span class="co">#&gt; 7679           38.5215835</span></a>
<a class="sourceLine" id="cb10-75" data-line-number="75"><span class="co">#&gt; 847             2.6264716</span></a>
<a class="sourceLine" id="cb10-76" data-line-number="76"><span class="co">#&gt; 2115            6.1284337</span></a>
<a class="sourceLine" id="cb10-77" data-line-number="77"><span class="co">#&gt; 9101           12.2568675</span></a>
<a class="sourceLine" id="cb10-78" data-line-number="78"><span class="co">#&gt; 6352           13.1323580</span></a>
<a class="sourceLine" id="cb10-79" data-line-number="79"><span class="co">#&gt; 10893          10.5058864</span></a>
<a class="sourceLine" id="cb10-80" data-line-number="80"><span class="co">#&gt; 4921            6.1284337</span></a>
<a class="sourceLine" id="cb10-81" data-line-number="81"><span class="co">#&gt; 5762            3.5019621</span></a>
<a class="sourceLine" id="cb10-82" data-line-number="82"><span class="co">#&gt; 7530            6.1284337</span></a>
<a class="sourceLine" id="cb10-83" data-line-number="83"><span class="co">#&gt; 12890           0.8754905</span></a>
<a class="sourceLine" id="cb10-84" data-line-number="84"></a>
<a class="sourceLine" id="cb10-85" data-line-number="85">obj =<span class="st"> </span>ttm<span class="op">$</span>object</a>
<a class="sourceLine" id="cb10-86" data-line-number="86"></a>
<a class="sourceLine" id="cb10-87" data-line-number="87">ttm<span class="op">$</span>pca.cell<span class="fl">.2</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Run this when B cells need to be removed.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">pdf</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning/&quot;</span>,t,<span class="st">&quot;_&quot;</span>,n_it,<span class="st">&quot;_plots_before_cells_exlusion.pdf&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">ttm<span class="op">$</span>pca.cell<span class="fl">.2</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">ggplot</span>(ttm<span class="op">$</span>D, <span class="kw">aes</span>(<span class="dt">x=</span>n,<span class="dt">y=</span>means)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data=</span><span class="kw">subset</span>(ttm<span class="op">$</span>D, n <span class="op">&gt;</span><span class="st"> </span>(<span class="kw">max</span>(ttm<span class="op">$</span>D<span class="op">$</span>n)<span class="op">-</span><span class="st"> </span><span class="dv">15</span>) ), <span class="kw">aes</span>(n,means,<span class="dt">label=</span><span class="kw">rownames</span>(ttm<span class="op">$</span>D[ttm<span class="op">$</span>D<span class="op">$</span>n <span class="op">&gt;</span><span class="st"> </span>(<span class="kw">max</span>(ttm<span class="op">$</span>D<span class="op">$</span>n)<span class="op">-</span><span class="st"> </span><span class="dv">15</span>),])),</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">                  <span class="dt">nudge_y      =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                  <span class="dt">nudge_x      =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                  <span class="dt">direction    =</span> <span class="st">&quot;x&quot;</span>,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">                  <span class="dt">angle        =</span> <span class="dv">90</span>,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">                  <span class="dt">vjust        =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">                  <span class="dt">segment.size =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;B cell group genes mean expression&quot;</span>)<span class="op">+</span>my_theme <span class="op">+</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>,<span class="dt">vjust =</span> <span class="op">-</span><span class="st"> </span><span class="dv">5</span>,<span class="dt">hjust =</span> <span class="fl">0.02</span> ))</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; Warning: ggrepel: 13 unlabeled data points (too many overlaps). Consider</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; increasing max.overlaps</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;   2</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="cf">if</span> (<span class="kw">length</span>(ttm<span class="op">$</span>cl1) <span class="op">&lt;</span><span class="st"> </span><span class="kw">length</span>(ttm<span class="op">$</span>cl2)) {</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">  to_rem =<span class="st"> </span>ttm<span class="op">$</span>cl1</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">}<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">  to_rem =<span class="st"> </span>ttm<span class="op">$</span>cl2</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">n_it =<span class="st"> </span>n_it<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25">obj<span class="op">@</span>raw =<span class="st"> </span>obj<span class="op">@</span>raw[,<span class="op">!</span><span class="kw">colnames</span>(obj<span class="op">@</span>raw) <span class="op">%in%</span><span class="st"> </span>to_rem]</a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#obj@raw = obj@raw[rownames(obj@raw) %in% rownames(cells),colnames(obj@raw) %in% colnames(cells)]</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt;             used   (Mb) gc trigger   (Mb)   max used   (Mb)</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt; Ncells   3753459  200.5    6224495  332.5    6224495  332.5</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt; Vcells 739732667 5643.8 1214347887 9264.8 1011885523 7720.1</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"></a>
<a class="sourceLine" id="cb11-32" data-line-number="32">ttm =<span class="st"> </span><span class="kw">clean</span>(obj)</a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt; [1] &quot;Start estimation mu with linear method&quot;</span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt; [1] 14433  7675</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt;       rowname p0-WT2_ACCGCAGAGGGC p0-WT2_CCCTAACCCCAT p0-WT2_CGGTCGTACACT</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">#&gt; 6103   Hbb-bs          1510.26571         1360.067486          598.326652</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co">#&gt; 6104   Hbb-bt           304.31935          421.429362          127.944064</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="co">#&gt; 6101   Hba-a1           335.07503          354.947190          110.383114</span></a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co">#&gt; 6102   Hba-a2           168.34687          233.251010           66.480739</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40"><span class="co">#&gt; 5912     Gpx1            50.18032            3.380449            3.763061</span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="co">#&gt; 7439   Malat1             3.23744            1.126816           46.411082</span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="co">#&gt; 1071    Alas2            17.80592           11.268165            2.508707</span></a>
<a class="sourceLine" id="cb11-43" data-line-number="43"><span class="co">#&gt; 4804     Fth1             8.09360            5.634082            5.017414</span></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co">#&gt; 8927   Pabpc1            19.42464            0.000000            0.000000</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45"><span class="co">#&gt; 13259  Tuba1a             1.61872            0.000000           20.069657</span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46"><span class="co">#&gt; 847      Actb             3.23744            0.000000           17.560950</span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47"><span class="co">#&gt; 1930     Bpgm             4.85616            3.380449            2.508707</span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co">#&gt; 7836    Mkrn1             8.09360            1.126816            0.000000</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49"><span class="co">#&gt; 11747    Snca             3.23744            5.634082            1.254354</span></a>
<a class="sourceLine" id="cb11-50" data-line-number="50"><span class="co">#&gt; 12887  Tmsb4x             0.00000            1.126816            7.526121</span></a>
<a class="sourceLine" id="cb11-51" data-line-number="51"><span class="co">#&gt;       p0-WT2_CTACTTGCCCGT p0-WT2_TCACGACGTTTN p0-WT2_TTACGACTCGAN</span></a>
<a class="sourceLine" id="cb11-52" data-line-number="52"><span class="co">#&gt; 6103          919.7849387         1393.879227         1376.342017</span></a>
<a class="sourceLine" id="cb11-53" data-line-number="53"><span class="co">#&gt; 6104          215.7520227          278.300119          406.908486</span></a>
<a class="sourceLine" id="cb11-54" data-line-number="54"><span class="co">#&gt; 6101          223.3222691          271.164218          352.730869</span></a>
<a class="sourceLine" id="cb11-55" data-line-number="55"><span class="co">#&gt; 6102          139.1032778          259.271051          263.971794</span></a>
<a class="sourceLine" id="cb11-56" data-line-number="56"><span class="co">#&gt; 5912           16.0867736            9.514534           20.748875</span></a>
<a class="sourceLine" id="cb11-57" data-line-number="57"><span class="co">#&gt; 7439           77.5950257            0.000000            0.000000</span></a>
<a class="sourceLine" id="cb11-58" data-line-number="58"><span class="co">#&gt; 1071            2.8388424           16.650434           18.443444</span></a>
<a class="sourceLine" id="cb11-59" data-line-number="59"><span class="co">#&gt; 4804            4.7314040            2.378633            2.305431</span></a>
<a class="sourceLine" id="cb11-60" data-line-number="60"><span class="co">#&gt; 8927            3.7851232            4.757267            1.152715</span></a>
<a class="sourceLine" id="cb11-61" data-line-number="61"><span class="co">#&gt; 13259           7.5702464            7.135900            5.763576</span></a>
<a class="sourceLine" id="cb11-62" data-line-number="62"><span class="co">#&gt; 847             3.7851232            2.378633            3.458146</span></a>
<a class="sourceLine" id="cb11-63" data-line-number="63"><span class="co">#&gt; 1930            2.8388424            4.757267            3.458146</span></a>
<a class="sourceLine" id="cb11-64" data-line-number="64"><span class="co">#&gt; 7836            0.9462808            0.000000            2.305431</span></a>
<a class="sourceLine" id="cb11-65" data-line-number="65"><span class="co">#&gt; 11747           1.8925616            2.378633            4.610861</span></a>
<a class="sourceLine" id="cb11-66" data-line-number="66"><span class="co">#&gt; 12887           0.9462808            4.757267            3.458146</span></a>
<a class="sourceLine" id="cb11-67" data-line-number="67"><span class="co">#&gt;       p0-WT3_AGAGGTGCTAGT p0-WT3_CTCCTAACGGAC p0-WT4_CAATACCGTAAC</span></a>
<a class="sourceLine" id="cb11-68" data-line-number="68"><span class="co">#&gt; 6103          1347.979875        1093.5829767          726.090046</span></a>
<a class="sourceLine" id="cb11-69" data-line-number="69"><span class="co">#&gt; 6104           467.299690         391.0924276          224.548702</span></a>
<a class="sourceLine" id="cb11-70" data-line-number="70"><span class="co">#&gt; 6101           464.031860         334.2733390          200.173349</span></a>
<a class="sourceLine" id="cb11-71" data-line-number="71"><span class="co">#&gt; 6102           266.328145         254.5790330          108.581116</span></a>
<a class="sourceLine" id="cb11-72" data-line-number="72"><span class="co">#&gt; 5912             6.535660          25.0889482            2.954588</span></a>
<a class="sourceLine" id="cb11-73" data-line-number="73"><span class="co">#&gt; 7439             0.000000          25.0889482            1.477294</span></a>
<a class="sourceLine" id="cb11-74" data-line-number="74"><span class="co">#&gt; 1071             8.169575           9.5928331            8.125118</span></a>
<a class="sourceLine" id="cb11-75" data-line-number="75"><span class="co">#&gt; 4804             8.169575          16.9719355            5.909176</span></a>
<a class="sourceLine" id="cb11-76" data-line-number="76"><span class="co">#&gt; 8927             0.000000          19.9235765            1.477294</span></a>
<a class="sourceLine" id="cb11-77" data-line-number="77"><span class="co">#&gt; 13259            1.633915           0.7379102           14.034294</span></a>
<a class="sourceLine" id="cb11-78" data-line-number="78"><span class="co">#&gt; 847              1.633915           4.4274614           14.772941</span></a>
<a class="sourceLine" id="cb11-79" data-line-number="79"><span class="co">#&gt; 1930             1.633915          10.3307434            0.000000</span></a>
<a class="sourceLine" id="cb11-80" data-line-number="80"><span class="co">#&gt; 7836             3.267830          12.5444741            2.954588</span></a>
<a class="sourceLine" id="cb11-81" data-line-number="81"><span class="co">#&gt; 11747            4.901745           0.0000000            2.954588</span></a>
<a class="sourceLine" id="cb11-82" data-line-number="82"><span class="co">#&gt; 12887            1.633915           2.9516410            8.125118</span></a>
<a class="sourceLine" id="cb11-83" data-line-number="83"><span class="co">#&gt;       p0-WT4_CTGAGTAACTTT p0-WT4_GCGGGCCTCTCG p0-WT4_GGACCACCATGA</span></a>
<a class="sourceLine" id="cb11-84" data-line-number="84"><span class="co">#&gt; 6103         1313.4473803          784.999535         1256.898569</span></a>
<a class="sourceLine" id="cb11-85" data-line-number="85"><span class="co">#&gt; 6104          543.8199039          192.967158          545.398085</span></a>
<a class="sourceLine" id="cb11-86" data-line-number="86"><span class="co">#&gt; 6101          332.1253046          187.258071          347.616362</span></a>
<a class="sourceLine" id="cb11-87" data-line-number="87"><span class="co">#&gt; 6102          286.0229252          127.312652          250.865995</span></a>
<a class="sourceLine" id="cb11-88" data-line-number="88"><span class="co">#&gt; 5912            5.6451893            3.425453           29.110730</span></a>
<a class="sourceLine" id="cb11-89" data-line-number="89"><span class="co">#&gt; 7439            0.9408649           11.418175            0.000000</span></a>
<a class="sourceLine" id="cb11-90" data-line-number="90"><span class="co">#&gt; 1071           12.2312435            5.138179           17.123959</span></a>
<a class="sourceLine" id="cb11-91" data-line-number="91"><span class="co">#&gt; 4804            7.5269191           16.556354            7.705781</span></a>
<a class="sourceLine" id="cb11-92" data-line-number="92"><span class="co">#&gt; 8927            5.6451893            5.709088            9.418177</span></a>
<a class="sourceLine" id="cb11-93" data-line-number="93"><span class="co">#&gt; 13259           1.8817298            2.854544            4.280990</span></a>
<a class="sourceLine" id="cb11-94" data-line-number="94"><span class="co">#&gt; 847             0.9408649            6.279996            3.424792</span></a>
<a class="sourceLine" id="cb11-95" data-line-number="95"><span class="co">#&gt; 1930            0.9408649            3.425453           11.130573</span></a>
<a class="sourceLine" id="cb11-96" data-line-number="96"><span class="co">#&gt; 7836            1.8817298            3.425453           10.274375</span></a>
<a class="sourceLine" id="cb11-97" data-line-number="97"><span class="co">#&gt; 11747           1.8817298            1.141818           11.986771</span></a>
<a class="sourceLine" id="cb11-98" data-line-number="98"><span class="co">#&gt; 12887           3.7634595           10.276358            3.424792</span></a>
<a class="sourceLine" id="cb11-99" data-line-number="99"><span class="co">#&gt;       p0-WT4_TTGAAACTTTTC</span></a>
<a class="sourceLine" id="cb11-100" data-line-number="100"><span class="co">#&gt; 6103          1332.664320</span></a>
<a class="sourceLine" id="cb11-101" data-line-number="101"><span class="co">#&gt; 6104           502.117599</span></a>
<a class="sourceLine" id="cb11-102" data-line-number="102"><span class="co">#&gt; 6101           353.692900</span></a>
<a class="sourceLine" id="cb11-103" data-line-number="103"><span class="co">#&gt; 6102           254.743101</span></a>
<a class="sourceLine" id="cb11-104" data-line-number="104"><span class="co">#&gt; 5912             5.263287</span></a>
<a class="sourceLine" id="cb11-105" data-line-number="105"><span class="co">#&gt; 7439             4.210630</span></a>
<a class="sourceLine" id="cb11-106" data-line-number="106"><span class="co">#&gt; 1071             8.421260</span></a>
<a class="sourceLine" id="cb11-107" data-line-number="107"><span class="co">#&gt; 4804            10.526574</span></a>
<a class="sourceLine" id="cb11-108" data-line-number="108"><span class="co">#&gt; 8927             4.210630</span></a>
<a class="sourceLine" id="cb11-109" data-line-number="109"><span class="co">#&gt; 13259            2.105315</span></a>
<a class="sourceLine" id="cb11-110" data-line-number="110"><span class="co">#&gt; 847              5.263287</span></a>
<a class="sourceLine" id="cb11-111" data-line-number="111"><span class="co">#&gt; 1930             2.105315</span></a>
<a class="sourceLine" id="cb11-112" data-line-number="112"><span class="co">#&gt; 7836             4.210630</span></a>
<a class="sourceLine" id="cb11-113" data-line-number="113"><span class="co">#&gt; 11747            6.315945</span></a>
<a class="sourceLine" id="cb11-114" data-line-number="114"><span class="co">#&gt; 12887            0.000000</span></a>
<a class="sourceLine" id="cb11-115" data-line-number="115"><span class="co">#ttm = clean.sqrt(obj, cells)</span></a>
<a class="sourceLine" id="cb11-116" data-line-number="116">obj =<span class="st"> </span>ttm<span class="op">$</span>object</a>
<a class="sourceLine" id="cb11-117" data-line-number="117"></a>
<a class="sourceLine" id="cb11-118" data-line-number="118">ttm<span class="op">$</span>pca.cell<span class="fl">.2</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre><code>#&gt; Warning: ggrepel: 11 unlabeled data points (too many overlaps). Consider
#&gt; increasing max.overlaps
#&gt; png 
#&gt;   2
#&gt;             used   (Mb) gc trigger    (Mb)   max used    (Mb)
#&gt; Ncells   3754505  200.6    6224495   332.5    6224495   332.5
#&gt; Vcells 758189641 5784.6 1748836956 13342.6 1748832979 13342.6
#&gt; [1] &quot;Start estimation mu with linear method&quot;
#&gt; [1] 14432  7662
#&gt;             rowname p0-WT2_AAGAAAGACTCN p0-WT2_AAGAATAGACTC p0-WT2_ACGCTTAGATCT
#&gt; 13254           Ttr         1217.302279         1123.775923          752.020748
#&gt; 7439         Malat1            0.000000            2.493586           32.621023
#&gt; 62    1500015O10Rik           11.226767           14.130319           18.337262
#&gt; 1294           Apoe            0.000000            6.649562           21.811690
#&gt; 6477         Igfbp2           16.038238            9.974343            9.651190
#&gt; 1971            Bsg           14.434414            9.974343           11.002357
#&gt; 1413        Arl6ip1           17.642062           14.130319           13.511666
#&gt; 847            Actb           12.830591           20.779880            9.844214
#&gt; 4804           Fth1           20.849710           18.286295            7.913976
#&gt; 3142           Cst3            9.622943            7.480757            8.493047
#&gt; 2817            Clu            1.603824            3.324781            5.983738
#&gt; 3000         Cox4i1            4.811471            7.480757            4.439548
#&gt; 11905         Sparc            1.603824            4.155976            9.651190
#&gt; 5761           Gnas           11.226767            3.324781            3.281405
#&gt; 4138          Enpp2            0.000000            2.493586           11.967476
#&gt;       p0-WT2_ACGTTCCCCGTC p0-WT2_ATCCACGGAGCN p0-WT2_ATTAGGGTCAAG
#&gt; 13254          764.941504          952.234482          901.949597
#&gt; 7439            23.131518           29.243285           23.358501
#&gt; 62              17.081736           14.621643            8.097614
#&gt; 1294            18.861084           31.070991           22.424161
#&gt; 6477            16.725867           18.277053            6.228934
#&gt; 1971            16.014128           14.621643           11.523527
#&gt; 1413             9.252607           10.966232           15.260888
#&gt; 847              5.338043            7.310821           11.212081
#&gt; 4804             9.786411            3.655411            5.917487
#&gt; 3142             4.982173           12.793937            6.851827
#&gt; 2817            10.142281            0.000000            5.294594
#&gt; 3000             5.160108           16.449348            5.606040
#&gt; 11905            7.651194            1.827705           11.212081
#&gt; 5761             6.049782            1.827705            2.180127
#&gt; 4138             6.405651            1.827705            5.917487
#&gt;       p0-WT2_GTCATTCCTCTC p0-WT2_GTCTTATTAGTA p0-WT2_TTAATAGAATCT
#&gt; 13254          869.287587         1164.869643          704.390419
#&gt; 7439            41.957614           15.891810           36.911288
#&gt; 62              10.199641            7.945905           30.759407
#&gt; 1294             8.345161            6.356724            9.227822
#&gt; 6477            13.676791           14.302629            6.151881
#&gt; 1971            14.835841           11.124267            1.537970
#&gt; 1413             7.417921            9.535086           12.303763
#&gt; 847              6.490681            7.945905            6.151881
#&gt; 4804             6.722491           11.124267            3.075941
#&gt; 3142             7.417921            7.945905            0.000000
#&gt; 2817            12.054121            9.535086            9.227822
#&gt; 3000             4.172580            6.356724           12.303763
#&gt; 11905           13.444981            3.178362            1.537970
#&gt; 5761             3.940770            4.767543            4.613911
#&gt; 4138             6.258871            6.356724           16.917674
#&gt;       p0-WT3_AAATCTGCTGGA p0-WT3_AAGTAATAGCAC p0-WT3_AATAGCCGGATG
#&gt; 13254         1070.650373         1107.917463         1217.527817
#&gt; 7439            13.917776           21.452791            0.000000
#&gt; 62              14.936150           10.488031           10.274496
#&gt; 1294             7.468075            8.581116            2.568624
#&gt; 6477             7.128617           12.394946           10.274496
#&gt; 1971             9.165365           11.441488            2.568624
#&gt; 1413            13.238860           11.441488            2.568624
#&gt; 847             11.202112            8.104388           12.843120
#&gt; 4804             8.825907            3.813829            2.568624
#&gt; 3142             8.146991            9.534574            7.705872
#&gt; 2817             7.807533            4.290558            2.568624
#&gt; 3000             6.789159            7.150930            7.705872
#&gt; 11905            3.734037            6.197473            2.568624
#&gt; 5761             6.449701            5.720744            5.137248
#&gt; 4138             4.412953            7.627659            2.568624
#&gt;       p0-WT3_AGTAAATGCCGG p0-WT3_CTTTTCAATATG p0-WT3_GACGTTCCCGCA
#&gt; 13254         1067.929605         1331.918004          609.055540
#&gt; 7439            25.175972            1.716389           20.954534
#&gt; 62              14.637193            1.716389           30.916525
#&gt; 1294            22.248533           17.163892           21.641567
#&gt; 6477             5.854877            8.581946           15.458262
#&gt; 1971             8.196828           15.447503           11.679576
#&gt; 1413             7.025853            6.865557           16.488813
#&gt; 847              4.098414           10.298335            5.839788
#&gt; 4804             8.196828            5.149168            8.931441
#&gt; 3142             2.341951            6.865557            8.587924
#&gt; 2817             7.611340            6.865557           17.519364
#&gt; 3000             2.341951            5.149168            4.122203
#&gt; 11905            8.782316            3.432778           18.206398
#&gt; 5761             5.269389            5.149168            8.244407
#&gt; 4138             6.440365            1.716389            5.496271
#&gt;       p0-WT3_GCGTTGTAGCAG p0-WT3_TCTGGCCGCACT p0-WT3_TGGGCGTTCCCG
#&gt; 13254         1326.094995         1049.745426          943.212474
#&gt; 7439             0.000000           34.982260           23.031932
#&gt; 62              15.343248           11.938390            3.290276
#&gt; 1294            13.151355            6.663288           18.644898
#&gt; 6477            26.302711           11.660753           12.064346
#&gt; 1971            10.959463           12.216027            9.870828
#&gt; 1413             8.767570            7.773835            9.870828
#&gt; 847              4.383785            6.940925           10.967587
#&gt; 4804             4.383785            6.663288            6.580552
#&gt; 3142             0.000000            8.606746           10.967587
#&gt; 2817             4.383785            5.275103            6.580552
#&gt; 3000             4.383785            7.496198            4.387035
#&gt; 11905            2.191893            3.054007            1.096759
#&gt; 5761            13.151355            5.830377            5.483793
#&gt; 4138             4.383785            8.051472           13.161104
#&gt;       p0-WT3_TTAGGCTTCCCG p0-WT4_CCCATACTGTAG p0-WT4_GCGACGGATATT
#&gt; 13254         1401.048190         1296.302791          879.780671
#&gt; 7439            33.450186            1.893795           25.312508
#&gt; 62              10.292365           10.415873           17.559127
#&gt; 1294             5.146183            3.787590           17.787168
#&gt; 6477            14.152002           11.362771           11.630071
#&gt; 1971             9.005819            7.575181           12.314193
#&gt; 1413             9.005819            9.468976           12.770274
#&gt; 847             11.578911            6.628283            4.104731
#&gt; 4804             3.859637            4.734488            7.297299
#&gt; 3142             5.146183            5.681385            4.788853
#&gt; 2817             6.432728            5.681385           10.033787
#&gt; 3000             0.000000            4.734488            8.209462
#&gt; 11905            6.432728            6.628283            6.841218
#&gt; 5761             3.859637            3.787590            4.788853
#&gt; 4138             1.286546            2.840693            3.876690
#&gt;       p0-WT4_TCCAAAGTTGAG p0-WT4_TCCGGAGGGTCC p0-WT4_TCGGAACGGTCC
#&gt; 13254         1004.460920         1180.578131          827.202477
#&gt; 7439            22.938410           20.872100           46.918349
#&gt; 62              14.487417           13.045062           10.929843
#&gt; 1294            15.694702           28.699137           12.262750
#&gt; 6477            10.865563           16.088910           11.463006
#&gt; 1971            12.072848           16.523745            9.330353
#&gt; 1413             7.243709            7.392202            4.265304
#&gt; 847              4.829139            2.609012            5.864794
#&gt; 4804             3.621854            6.522531            6.931120
#&gt; 3142            13.280132            8.696708            5.864794
#&gt; 2817             4.829139            8.696708           11.996169
#&gt; 3000             9.658278            5.652860            3.465560
#&gt; 11905            4.829139           10.001214            8.264027
#&gt; 5761             8.450993            5.218025            5.331631
#&gt; 4138             4.829139            6.087696            2.665815
#&gt;       p0-WT4_TGTATAGGAAAG p0-WT4_TTGTTTTGCACG
#&gt; 13254          655.456794          716.143243
#&gt; 7439            19.988266           17.691844
#&gt; 62              18.009230           12.610144
#&gt; 1294             3.760169            8.281288
#&gt; 6477            13.259543           14.304044
#&gt; 1971             9.499374           13.739410
#&gt; 1413            16.623904           15.997944
#&gt; 847              9.301470            3.387800
#&gt; 4804             8.114048            7.716655
#&gt; 3142             4.749687            7.904866
#&gt; 2817             6.926627            6.210966
#&gt; 3000             6.728723            7.904866
#&gt; 11905            5.145494            5.269911
#&gt; 5761             5.739205            6.210966
#&gt; 4138             8.311952            2.823167</code></pre>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre><code>#&gt; Warning: ggrepel: 14 unlabeled data points (too many overlaps). Consider
#&gt; increasing max.overlaps
#&gt; png 
#&gt;   2
#&gt;             used   (Mb) gc trigger    (Mb)   max used    (Mb)
#&gt; Ncells   3754790  200.6    6224495   332.5    6224495   332.5
#&gt; Vcells 757358929 5778.2 2098684347 16011.7 2098677190 16011.7
#&gt; [1] &quot;Start estimation mu with linear method&quot;
#&gt; [1] 14387  7636
#&gt;       rowname p0-WT4_CGTAAACCCAGC
#&gt; 7649     Meg3           282.81485
#&gt; 7410   Malat1           210.09103
#&gt; 11714  Snhg11            56.56297
#&gt; 11815     Son            16.16085
#&gt; 1938     Brd8            12.12064
#&gt; 2560    Celf4            12.12064
#&gt; 2804     Clta            12.12064
#&gt; 4711   Fnbp1l            12.12064
#&gt; 6330  Hsp90b1            12.12064
#&gt; 6891    Kif5c            12.12064
#&gt; 7442     Map2            12.12064
#&gt; 8520     Nnat            12.12064
#&gt; 10856    Rtn1            12.12064
#&gt; 11988   Srrm2            12.12064
#&gt; 13216  Tuba1a            12.12064</code></pre>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Run this only in the last iteration, instead the previus code, when B cells group has not to be removed</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">pdf</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning/&quot;</span>,t,<span class="st">&quot;_&quot;</span>,n_it,<span class="st">&quot;_plots_before_cells_exlusion.pdf&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">ttm<span class="op">$</span>pca.cell<span class="fl">.2</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">ggplot</span>(ttm<span class="op">$</span>D, <span class="kw">aes</span>(<span class="dt">x=</span>n,<span class="dt">y=</span>means)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">data=</span><span class="kw">subset</span>(ttm<span class="op">$</span>D, n <span class="op">&gt;</span><span class="st"> </span>(<span class="kw">max</span>(ttm<span class="op">$</span>D<span class="op">$</span>n)<span class="op">-</span><span class="st"> </span><span class="dv">15</span>) ), <span class="kw">aes</span>(n,means,<span class="dt">label=</span><span class="kw">rownames</span>(ttm<span class="op">$</span>D[ttm<span class="op">$</span>D<span class="op">$</span>n <span class="op">&gt;</span><span class="st"> </span>(<span class="kw">max</span>(ttm<span class="op">$</span>D<span class="op">$</span>n)<span class="op">-</span><span class="st"> </span><span class="dv">15</span>),])),</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">                  <span class="dt">nudge_y      =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">                  <span class="dt">nudge_x      =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">                  <span class="dt">direction    =</span> <span class="st">&quot;x&quot;</span>,</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">                  <span class="dt">angle        =</span> <span class="dv">90</span>,</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">                  <span class="dt">vjust        =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">                  <span class="dt">segment.size =</span> <span class="fl">0.2</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="dt">label =</span> <span class="st">&quot;B cell group genes mean expression&quot;</span>, <span class="dt">subtitle =</span> <span class="st">&quot; - B group NOT removed -&quot;</span>)<span class="op">+</span>my_theme <span class="op">+</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">20</span>, <span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>,<span class="dt">vjust =</span> <span class="op">-</span><span class="st"> </span><span class="dv">10</span>,<span class="dt">hjust =</span> <span class="fl">0.02</span> ),</a>
<a class="sourceLine" id="cb14-13" data-line-number="13">        <span class="dt">plot.subtitle =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;darkred&quot;</span>,<span class="dt">vjust =</span> <span class="op">-</span><span class="st"> </span><span class="dv">15</span>,<span class="dt">hjust =</span> <span class="fl">0.01</span> ))</a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; Warning: ggrepel: 12 unlabeled data points (too many overlaps). Consider</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; increasing max.overlaps</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;   2</span></a></code></pre></div>
<p>To color the pca based on nu_j (so the cells’ efficiency)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">nu_est =<span class="st"> </span><span class="kw">round</span>(obj<span class="op">@</span>nu, <span class="dt">digits =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">plot.nu &lt;-<span class="kw">ggplot</span>(ttm<span class="op">$</span>pca_cells,<span class="kw">aes</span>(<span class="dt">x=</span>PC1,<span class="dt">y=</span>PC2, <span class="dt">colour =</span> <span class="kw">log</span>(nu_est)))</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">plot.nu =<span class="st"> </span>plot.nu <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>,<span class="dt">alpha=</span> <span class="fl">0.8</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_color_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;#E64B35B2&quot;</span>,<span class="dt">mid =</span>  <span class="st">&quot;#4DBBD5B2&quot;</span>, <span class="dt">high =</span>  <span class="st">&quot;#3C5488B2&quot;</span> ,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                        <span class="dt">midpoint =</span> <span class="kw">log</span>(<span class="kw">mean</span>(nu_est)),<span class="dt">name =</span> <span class="st">&quot;ln (nu)&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells PCA coloured by cells efficiency&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span>my_theme <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">                    <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">14</span>,<span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>),</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">                    <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">                    <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>),</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">                    <span class="dt">legend.position=</span><span class="st">&quot;right&quot;</span>)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="kw">pdf</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning/&quot;</span>,t,<span class="st">&quot;_plots_PCA_efficiency_colored.pdf&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">plot.nu</a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt;   2</span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"></a>
<a class="sourceLine" id="cb15-21" data-line-number="21">plot.nu</a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-15-1.png" width="672" /> The next part is use to remove the cells with efficiency too low.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">nu_df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;nu&quot;</span>=<span class="st"> </span><span class="kw">sort</span>(obj<span class="op">@</span>nu), <span class="st">&quot;n&quot;</span>=<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(obj<span class="op">@</span>nu)))</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">ggplot</span>(nu_df, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y=</span>nu)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;#8491B4B2&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">    </span>my_theme <span class="co">#+ ylim(0,1) + xlim(0,70)</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>We can zoom on the smalest values and, if we detect a clear elbow, we can decide to remove the cells.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">yset =<span class="st"> </span><span class="fl">0.35</span><span class="co">#threshold to remove low UDE cells</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">plot.ude &lt;-<span class="st"> </span><span class="kw">ggplot</span>(nu_df, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y=</span>nu)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;#8491B4B2&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">    </span>my_theme <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="fl">0.</span>,<span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlim</span>(<span class="dv">0</span>,<span class="dv">2000</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span>yset, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;darkred&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="st">    </span><span class="kw">annotate</span>(<span class="dt">geom=</span><span class="st">&quot;text&quot;</span>, <span class="dt">x=</span><span class="dv">500</span>, <span class="dt">y=</span><span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb17-7" data-line-number="7">             <span class="dt">label=</span><span class="kw">paste</span>(<span class="st">&quot;to remove cells with nu &lt; &quot;</span>,yset,<span class="dt">sep =</span> <span class="st">&quot; &quot;</span>), </a>
<a class="sourceLine" id="cb17-8" data-line-number="8">             <span class="dt">color=</span><span class="st">&quot;darkred&quot;</span>, <span class="dt">size=</span><span class="fl">4.5</span>)</a>
<a class="sourceLine" id="cb17-9" data-line-number="9"></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="kw">pdf</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning/&quot;</span>,t,<span class="st">&quot;_plots_efficiency.pdf&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">plot.ude</a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; Warning: Removed 5636 rows containing missing values (geom_point).</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt;   2</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"></a>
<a class="sourceLine" id="cb17-18" data-line-number="18">plot.ude</a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="co">#&gt; Warning: Removed 5636 rows containing missing values (geom_point).</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /> We also save the defined treshold in the metadata and re run the estimation</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">obj<span class="op">@</span>meta[(<span class="kw">nrow</span>(obj<span class="op">@</span>meta)<span class="op">+</span><span class="dv">1</span>),<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Threshold low UDE cells:&quot;</span>,yset)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">to_rem =<span class="st"> </span><span class="kw">rownames</span>(nu_df[<span class="kw">which</span>(nu_df<span class="op">$</span>nu <span class="op">&lt;</span><span class="st"> </span>yset),])</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">obj<span class="op">@</span>raw =<span class="st"> </span>obj<span class="op">@</span>raw[, <span class="op">!</span><span class="kw">colnames</span>(obj<span class="op">@</span>raw) <span class="op">%in%</span><span class="st"> </span>to_rem]</a></code></pre></div>
<p>Repeat the estimation after the cells are removed</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">ttm =<span class="st"> </span><span class="kw">clean</span>(obj)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Start estimation mu with linear method&quot;</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; [1] 14382  7554</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;       rowname p0-WT2_AAAGTGCTAGCC p0-WT2_GAAGTTAGGGAN p0-WT2_GATCTAGCGTGG</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; 1287     Apoe           277.40779          270.637698          273.898393</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; 12839  Tmsb4x            42.12655           42.389037           62.922604</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; 3169     Ctsd            95.45696           44.019385            7.402659</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt; 3167     Ctsb            52.43411           45.649732           11.103989</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; 841      Actb            25.54482           39.128342           43.182179</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt; 3127     Cst3            30.02637           37.497994           12.337765</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt; 2009     C1qb            17.02988           35.867647           25.909307</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt; 2011     C1qc            22.85589           30.976604           25.909307</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt; 4784     Fth1            28.23375            9.782085            9.870212</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt; 1667      B2m            18.37434           32.606952           18.506648</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt; 7102     Lgmn            18.37434           37.497994            8.636436</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt; 13273  Tyrobp            18.82250           17.933823            6.168883</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt; 7406   Malat1             9.41125            1.630348           11.103989</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; 10672  Rpl13a            12.54833           21.194519           13.571542</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt; 11117   Sepp1            12.54833           13.042781            6.168883</span></a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="co">#&gt;       p0-WT2_GATCTAGCGTGN p0-WT2_GGATCCGCCCAA p0-WT3_AACAGTGCAGAA</span></a>
<a class="sourceLine" id="cb19-21" data-line-number="21"><span class="co">#&gt; 1287           229.480218          285.411229          270.247259</span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"><span class="co">#&gt; 12839           67.598824           97.457493           32.923524</span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="co">#&gt; 3169             5.336749           29.585310           12.346321</span></a>
<a class="sourceLine" id="cb19-24" data-line-number="24"><span class="co">#&gt; 3167             7.115666           27.844998            9.602694</span></a>
<a class="sourceLine" id="cb19-25" data-line-number="25"><span class="co">#&gt; 841             23.125913           43.507809           16.461762</span></a>
<a class="sourceLine" id="cb19-26" data-line-number="26"><span class="co">#&gt; 3127            12.452415           31.325623           27.436270</span></a>
<a class="sourceLine" id="cb19-27" data-line-number="27"><span class="co">#&gt; 2009            37.357245           24.364373           20.577202</span></a>
<a class="sourceLine" id="cb19-28" data-line-number="28"><span class="co">#&gt; 2011            17.789164           19.143436           17.833575</span></a>
<a class="sourceLine" id="cb19-29" data-line-number="29"><span class="co">#&gt; 4784            17.789164           22.624061           17.833575</span></a>
<a class="sourceLine" id="cb19-30" data-line-number="30"><span class="co">#&gt; 1667            16.010248           17.403124           10.974508</span></a>
<a class="sourceLine" id="cb19-31" data-line-number="31"><span class="co">#&gt; 7102             3.557833            8.701562           10.974508</span></a>
<a class="sourceLine" id="cb19-32" data-line-number="32"><span class="co">#&gt; 13273           10.673499           13.922499           15.089948</span></a>
<a class="sourceLine" id="cb19-33" data-line-number="33"><span class="co">#&gt; 7406            10.673499            8.701562           12.346321</span></a>
<a class="sourceLine" id="cb19-34" data-line-number="34"><span class="co">#&gt; 10672           10.673499            6.961249           19.205389</span></a>
<a class="sourceLine" id="cb19-35" data-line-number="35"><span class="co">#&gt; 11117            5.336749            5.220937            9.602694</span></a>
<a class="sourceLine" id="cb19-36" data-line-number="36"><span class="co">#&gt;       p0-WT3_GCCTTCCTCCGA</span></a>
<a class="sourceLine" id="cb19-37" data-line-number="37"><span class="co">#&gt; 1287           227.176931</span></a>
<a class="sourceLine" id="cb19-38" data-line-number="38"><span class="co">#&gt; 12839           57.665013</span></a>
<a class="sourceLine" id="cb19-39" data-line-number="39"><span class="co">#&gt; 3169            72.758540</span></a>
<a class="sourceLine" id="cb19-40" data-line-number="40"><span class="co">#&gt; 3167            56.890986</span></a>
<a class="sourceLine" id="cb19-41" data-line-number="41"><span class="co">#&gt; 841             16.254567</span></a>
<a class="sourceLine" id="cb19-42" data-line-number="42"><span class="co">#&gt; 3127            37.540311</span></a>
<a class="sourceLine" id="cb19-43" data-line-number="43"><span class="co">#&gt; 2009            18.189635</span></a>
<a class="sourceLine" id="cb19-44" data-line-number="44"><span class="co">#&gt; 2011            26.703932</span></a>
<a class="sourceLine" id="cb19-45" data-line-number="45"><span class="co">#&gt; 4784            22.059770</span></a>
<a class="sourceLine" id="cb19-46" data-line-number="46"><span class="co">#&gt; 1667            13.545473</span></a>
<a class="sourceLine" id="cb19-47" data-line-number="47"><span class="co">#&gt; 7102            13.545473</span></a>
<a class="sourceLine" id="cb19-48" data-line-number="48"><span class="co">#&gt; 13273           17.802622</span></a>
<a class="sourceLine" id="cb19-49" data-line-number="49"><span class="co">#&gt; 7406            40.249405</span></a>
<a class="sourceLine" id="cb19-50" data-line-number="50"><span class="co">#&gt; 10672            9.288324</span></a>
<a class="sourceLine" id="cb19-51" data-line-number="51"><span class="co">#&gt; 11117           41.023432</span></a>
<a class="sourceLine" id="cb19-52" data-line-number="52">obj =<span class="st"> </span>ttm<span class="op">$</span>object</a>
<a class="sourceLine" id="cb19-53" data-line-number="53">ttm<span class="op">$</span>pca.cell<span class="fl">.2</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Just to check again, we plot the final efficiency colored PCA</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">nu_est =<span class="st"> </span><span class="kw">round</span>(obj<span class="op">@</span>nu, <span class="dt">digits =</span> <span class="dv">7</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">plot.nu &lt;-<span class="kw">ggplot</span>(ttm<span class="op">$</span>pca_cells,<span class="kw">aes</span>(<span class="dt">x=</span>PC1,<span class="dt">y=</span>PC2, <span class="dt">colour =</span> <span class="kw">log</span>(nu_est)))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">plot.nu =<span class="st"> </span>plot.nu <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>,<span class="dt">alpha=</span> <span class="fl">0.8</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_color_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;#E64B35B2&quot;</span>,<span class="dt">mid =</span>  <span class="st">&quot;#4DBBD5B2&quot;</span>, <span class="dt">high =</span>  <span class="st">&quot;#3C5488B2&quot;</span> ,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">                        <span class="dt">midpoint =</span> <span class="kw">log</span>(<span class="kw">mean</span>(nu_est)),<span class="dt">name =</span> <span class="st">&quot;ln(nu)&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Cells PCA coloured by cells efficiency: last&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="st">  </span>my_theme <span class="op">+</span><span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">                    <span class="dt">legend.title=</span><span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">14</span>,<span class="dt">face =</span> <span class="st">&quot;italic&quot;</span>),</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">                    <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>, <span class="dt">size =</span> <span class="dv">11</span>),</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">                    <span class="dt">legend.key.width =</span> <span class="kw">unit</span>(<span class="dv">2</span>, <span class="st">&quot;mm&quot;</span>),</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">                    <span class="dt">legend.position=</span><span class="st">&quot;right&quot;</span>)</a>
<a class="sourceLine" id="cb20-12" data-line-number="12"></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="kw">pdf</span>(<span class="kw">paste</span>(out_dir,<span class="st">&quot;cleaning/&quot;</span>,t,<span class="st">&quot;_plots_PCA_efficiency_colored_FINAL.pdf&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb20-14" data-line-number="14">plot.nu</a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="kw">dev.off</span>()</a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; png </span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt;   2</span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"></a>
<a class="sourceLine" id="cb20-19" data-line-number="19">plot.nu</a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /> COTAN analysis: in this part all the contingency tables are computed and used to get the statistics (S) To storage efficincy of all the observed tables only the yes_yes is stored. Note that if will be necessary re-coputing the yes-yes table, the yes-yes table should be cancelled before running cotan_analysis.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># obj@yes_yes = c()</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">obj =<span class="st"> </span><span class="kw">cotan_analysis</span>(obj)</a></code></pre></div>
<p>COEX evaluation and storing</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">saveRDS</span>(obj,<span class="dt">file =</span> <span class="kw">paste</span>(out_dir,t,<span class="st">&quot;.cotan.RDS&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"></a>
<a class="sourceLine" id="cb22-3" data-line-number="3">obj =<span class="st"> </span><span class="kw">get.coex</span>(obj)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co"># saving the structure </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="kw">saveRDS</span>(obj,<span class="dt">file =</span> <span class="kw">paste</span>(out_dir,t,<span class="st">&quot;.cotan.RDS&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a></code></pre></div>
</div>
<div id="analysis-of-the-elaborated-data" class="section level2">
<h2><span class="header-section-number">0.3</span> Analysis of the elaborated data</h2>
<div id="gdi" class="section level3">
<h3><span class="header-section-number">0.3.1</span> GDI</h3>
<p>The next function can directly plot the GDI for the dataset with the 1.5 threshold (in red) and the two higher quantiles (in blue).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">obj =<span class="st"> </span><span class="kw">readRDS</span>(<span class="kw">paste</span>(out_dir,t,<span class="st">&quot;.cotan.RDS&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">plot.GDI</span>(obj, <span class="dt">cond =</span> <span class="st">&quot;P0&quot;</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">#&gt; [1] &quot;GDI plot &quot;</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#&gt; [1] &quot;function to generate GDI dataframe&quot;</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">#&gt; [1] &quot;Using S&quot;</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co">#&gt; [1] &quot;function to generate S &quot;</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>If a more complex plot is needed, or if we want to analize mor in detail the GDI data, we can get direcly the GDI dataframe.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">quant.p =<span class="st"> </span><span class="kw">get.GDI</span>(obj)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="co">#&gt; [1] &quot;function to generate GDI dataframe&quot;</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt; [1] &quot;Using S&quot;</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt; [1] &quot;function to generate S &quot;</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="kw">head</span>(quant.p)</a></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["sum.raw.norm"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["GDI"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["exp.cells"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"3.439025","2":"1.261301","3":"0.3177125","_rn_":"0610005C13Rik"},{"1":"5.352070","2":"2.599832","3":"2.0916071","_rn_":"0610007N19Rik"},{"1":"7.718572","2":"2.070818","3":"23.1135822","_rn_":"0610007P14Rik"},{"1":"7.075439","2":"2.047966","3":"13.5954461","_rn_":"0610009B22Rik"},{"1":"8.811660","2":"1.861726","3":"51.6944665","_rn_":"0610009D07Rik"},{"1":"4.905004","2":"2.297613","3":"1.7209425","_rn_":"0610009E02Rik"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>In the third column of this dataframe is reported the percentage of cells expressing the gene.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">NPGs=<span class="kw">c</span>(<span class="st">&quot;Nes&quot;</span>,<span class="st">&quot;Vim&quot;</span>,<span class="st">&quot;Sox2&quot;</span>,<span class="st">&quot;Sox1&quot;</span>,<span class="st">&quot;Notch1&quot;</span>, <span class="st">&quot;Hes1&quot;</span>,<span class="st">&quot;Hes5&quot;</span>,<span class="st">&quot;Pax6&quot;</span>) <span class="co">#,&quot;Hes3&quot;</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">PNGs=<span class="kw">c</span>(<span class="st">&quot;Map2&quot;</span>,<span class="st">&quot;Tubb3&quot;</span>,<span class="st">&quot;Neurod1&quot;</span>,<span class="st">&quot;Nefm&quot;</span>,<span class="st">&quot;Nefl&quot;</span>,<span class="st">&quot;Dcx&quot;</span>,<span class="st">&quot;Tbr1&quot;</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">hk=<span class="kw">c</span>(<span class="st">&quot;Calm1&quot;</span>,<span class="st">&quot;Cox6b1&quot;</span>,<span class="st">&quot;Ppia&quot;</span>,<span class="st">&quot;Rpl18&quot;</span>,<span class="st">&quot;Cox7c&quot;</span>,<span class="st">&quot;Erh&quot;</span>,<span class="st">&quot;H3f3a&quot;</span>,<span class="st">&quot;Taf1&quot;</span>,<span class="st">&quot;Taf2&quot;</span>,<span class="st">&quot;Gapdh&quot;</span>,<span class="st">&quot;Actb&quot;</span>,<span class="st">&quot;Golph3&quot;</span>, <span class="st">&quot;Mtmr12&quot;</span>, <span class="st">&quot;Zfr&quot;</span>, <span class="st">&quot;Sub1&quot;</span>, <span class="st">&quot;Tars&quot;</span>, <span class="st">&quot;Amacr&quot;</span>)</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">text.size =<span class="st"> </span><span class="dv">12</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"></a>
<a class="sourceLine" id="cb25-7" data-line-number="7">quant.p<span class="op">$</span>highlight =<span class="st"> </span><span class="kw">with</span>(quant.p, <span class="kw">ifelse</span>(<span class="kw">rownames</span>(quant.p) <span class="op">%in%</span><span class="st"> </span>NPGs, <span class="st">&quot;NPGs&quot;</span>,</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">                                                 <span class="kw">ifelse</span>(<span class="kw">rownames</span>(quant.p) <span class="op">%in%</span><span class="st"> </span>hk,<span class="st">&quot;Constitutive&quot;</span> ,</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">                                                               <span class="kw">ifelse</span>(<span class="kw">rownames</span>(quant.p) <span class="op">%in%</span><span class="st"> </span>PNGs,<span class="st">&quot;PNGs&quot;</span> , <span class="st">&quot;normal&quot;</span>))))</a>
<a class="sourceLine" id="cb25-10" data-line-number="10"></a>
<a class="sourceLine" id="cb25-11" data-line-number="11">textdf &lt;-<span class="st"> </span>quant.p[<span class="kw">rownames</span>(quant.p) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(NPGs,hk,PNGs), ]</a>
<a class="sourceLine" id="cb25-12" data-line-number="12">mycolours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Constitutive&quot;</span> =<span class="st"> &quot;#00A087FF&quot;</span>,<span class="st">&quot;NPGs&quot;</span>=<span class="st">&quot;#E64B35FF&quot;</span>,<span class="st">&quot;PNGs&quot;</span>=<span class="st">&quot;#F39B7FFF&quot;</span>,<span class="st">&quot;normal&quot;</span> =<span class="st"> &quot;#8491B4B2&quot;</span>)</a>
<a class="sourceLine" id="cb25-13" data-line-number="13">f1 =<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(quant.p,highlight <span class="op">==</span><span class="st"> &quot;normal&quot;</span> ), <span class="kw">aes</span>(<span class="dt">x=</span>sum.raw.norm, <span class="dt">y=</span>GDI)) <span class="op">+</span><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">color =</span> <span class="st">&quot;#8491B4B2&quot;</span>, <span class="dt">size=</span><span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb25-14" data-line-number="14">GDI_plot =<span class="st"> </span>f1 <span class="op">+</span><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">subset</span>(quant.p,highlight <span class="op">!=</span><span class="st"> &quot;normal&quot;</span>  ), <span class="kw">aes</span>(<span class="dt">x=</span>sum.raw.norm, <span class="dt">y=</span>GDI, <span class="dt">colour=</span>highlight),<span class="dt">size=</span><span class="fl">2.5</span>,<span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">quantile</span>(quant.p<span class="op">$</span>GDI)[<span class="dv">4</span>], <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="kw">quantile</span>(quant.p<span class="op">$</span>GDI)[<span class="dv">3</span>], <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;darkblue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="fl">1.5</span>, <span class="dt">linetype=</span><span class="st">&quot;dotted&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size=</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="st">&quot;Status&quot;</span>, <span class="dt">values =</span> mycolours)  <span class="op">+</span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;Status&quot;</span>, <span class="dt">values =</span> mycolours)  <span class="op">+</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;log normalized counts&quot;</span>)<span class="op">+</span><span class="kw">ylab</span>(<span class="st">&quot;GDI&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb25-21" data-line-number="21"><span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="dt">data =</span>textdf , <span class="kw">aes</span>(<span class="dt">x=</span>sum.raw.norm, <span class="dt">y=</span>GDI, <span class="dt">label =</span> <span class="kw">rownames</span>(textdf),<span class="dt">fill=</span>highlight),</a>
<a class="sourceLine" id="cb25-22" data-line-number="22">                   <span class="dt">label.size =</span> <span class="ot">NA</span>, </a>
<a class="sourceLine" id="cb25-23" data-line-number="23">                   <span class="dt">alpha =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb25-24" data-line-number="24">                   <span class="dt">direction =</span><span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb25-25" data-line-number="25">                   <span class="dt">na.rm=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb25-26" data-line-number="26">                   <span class="dt">seed =</span> <span class="dv">1234</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-27" data-line-number="27"><span class="st">  </span><span class="kw">geom_label_repel</span>(<span class="dt">data =</span>textdf , <span class="kw">aes</span>(<span class="dt">x=</span>sum.raw.norm, <span class="dt">y=</span>GDI, <span class="dt">label =</span> <span class="kw">rownames</span>(textdf)),</a>
<a class="sourceLine" id="cb25-28" data-line-number="28">                   <span class="dt">label.size =</span> <span class="ot">NA</span>, </a>
<a class="sourceLine" id="cb25-29" data-line-number="29">                   <span class="dt">segment.color =</span> <span class="st">&#39;black&#39;</span>,</a>
<a class="sourceLine" id="cb25-30" data-line-number="30">                   <span class="dt">segment.size =</span> <span class="fl">0.5</span>,</a>
<a class="sourceLine" id="cb25-31" data-line-number="31">                   <span class="dt">direction =</span> <span class="st">&quot;both&quot;</span>,</a>
<a class="sourceLine" id="cb25-32" data-line-number="32">                   <span class="dt">alpha =</span> <span class="fl">0.8</span>, </a>
<a class="sourceLine" id="cb25-33" data-line-number="33">                   <span class="dt">na.rm=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb25-34" data-line-number="34">                   <span class="dt">fill =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb25-35" data-line-number="35">                   <span class="dt">seed =</span> <span class="dv">1234</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-36" data-line-number="36"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> text.size, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span> ),</a>
<a class="sourceLine" id="cb25-37" data-line-number="37">        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> text.size, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>),  </a>
<a class="sourceLine" id="cb25-38" data-line-number="38">        <span class="dt">axis.title.x =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> text.size, <span class="dt">angle =</span> <span class="dv">0</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="dv">0</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>),</a>
<a class="sourceLine" id="cb25-39" data-line-number="39">        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>( <span class="dt">size =</span> text.size, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="fl">.5</span>, <span class="dt">vjust =</span> <span class="fl">.5</span>, <span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span><span class="st">&quot;#3C5488FF&quot;</span>),</a>
<a class="sourceLine" id="cb25-40" data-line-number="40">        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb25-41" data-line-number="41">        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;#3C5488FF&quot;</span>,<span class="dt">face =</span><span class="st">&quot;italic&quot;</span> ),</a>
<a class="sourceLine" id="cb25-42" data-line-number="42">        <span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)  <span class="co"># titl)</span></a>
<a class="sourceLine" id="cb25-43" data-line-number="43">legend &lt;-<span class="st"> </span>cowplot<span class="op">::</span><span class="kw">get_legend</span>(GDI_plot)</a>
<a class="sourceLine" id="cb25-44" data-line-number="44">GDI_plot =GDI_plot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb25-45" data-line-number="45">        <span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) </a>
<a class="sourceLine" id="cb25-46" data-line-number="46">GDI_plot</a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="heatmaps" class="section level3">
<h3><span class="header-section-number">0.3.2</span> Heatmaps</h3>
<p>For the Gene Pair Analysis, we can plot an heatmap with the coex values between two genes sets. To do so we need to define, in a list, the different gene sets (list.genes). Then in the function parameter sets we can decide which sets need to be considered (in the example from 1 to 3). In the condition parameter we should insert an array with each file name prefix to be considered (in the example, the file names is “E17.5_cortex”).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">list.genes =<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;Ref.col&quot;</span>=<span class="st"> </span>PNGs, <span class="st">&quot;NPGs&quot;</span>=NPGs, <span class="st">&quot;Const.&quot;</span>=hk )</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw">plot.heatmap</span>(<span class="dt">df_genes =</span> list.genes,<span class="dt">sets =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>),<span class="dt">conditions =</span> <span class="st">&quot;P0_cortex&quot;</span>,<span class="dt">dir =</span> <span class="st">&quot;Data/&quot;</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#&gt; [1] &quot;plot heatmap&quot;</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#&gt; [1] &quot;Loading condition P0_cortex&quot;</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">#&gt; [1] &quot;Map2&quot;    &quot;Tubb3&quot;   &quot;Neurod1&quot; &quot;Nefm&quot;    &quot;Nefl&quot;    &quot;Dcx&quot;     &quot;Tbr1&quot;   </span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">#&gt; [1] &quot;Get p-values on a set of genes on columns on a set of genes on rows&quot;</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">#&gt; [1] &quot;Using function S&quot;</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">#&gt; [1] &quot;function to generate S &quot;</span></a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">#&gt; [1] &quot;Ref.col&quot;</span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">#&gt; [1] &quot;NPGs&quot;</span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">#&gt; [1] &quot;Const.&quot;</span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">#&gt; [1] &quot;min coex: -0.00402368455132171 max coex 0.00363639659040585&quot;</span></a></code></pre></div>
<p><img src="P0_cortex_analysis_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">sessionInfo</span>())</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co">#&gt; R version 4.0.4 (2021-02-15)</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt; Running under: Ubuntu 18.04.5 LTS</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="co">#&gt; Matrix products: default</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; BLAS:   /usr/lib/x86_64-linux-gnu/openblas/libblas.so.3</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="co">#&gt; LAPACK: /usr/lib/x86_64-linux-gnu/libopenblasp-r0.2.20.so</span></a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; locale:</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15"><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></a>
<a class="sourceLine" id="cb27-16" data-line-number="16"><span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></a>
<a class="sourceLine" id="cb27-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-18" data-line-number="18"><span class="co">#&gt; attached base packages:</span></a>
<a class="sourceLine" id="cb27-19" data-line-number="19"><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></a>
<a class="sourceLine" id="cb27-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-21" data-line-number="21"><span class="co">#&gt; other attached packages:</span></a>
<a class="sourceLine" id="cb27-22" data-line-number="22"><span class="co">#&gt; [1] ggrepel_0.9.1     ggplot2_3.3.3     Matrix_1.3-2      data.table_1.13.6</span></a>
<a class="sourceLine" id="cb27-23" data-line-number="23"><span class="co">#&gt; [5] COTAN_0.1.0      </span></a>
<a class="sourceLine" id="cb27-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb27-25" data-line-number="25"><span class="co">#&gt; loaded via a namespace (and not attached):</span></a>
<a class="sourceLine" id="cb27-26" data-line-number="26"><span class="co">#&gt;  [1] Rcpp_1.0.6           lattice_0.20-41      circlize_0.4.12     </span></a>
<a class="sourceLine" id="cb27-27" data-line-number="27"><span class="co">#&gt;  [4] tidyr_1.1.2          png_0.1-7            assertthat_0.2.1    </span></a>
<a class="sourceLine" id="cb27-28" data-line-number="28"><span class="co">#&gt;  [7] digest_0.6.27        R6_2.5.0             stats4_4.0.4        </span></a>
<a class="sourceLine" id="cb27-29" data-line-number="29"><span class="co">#&gt; [10] evaluate_0.14        highr_0.8            pillar_1.4.7        </span></a>
<a class="sourceLine" id="cb27-30" data-line-number="30"><span class="co">#&gt; [13] basilisk_1.2.1       GlobalOptions_0.1.2  rlang_0.4.10        </span></a>
<a class="sourceLine" id="cb27-31" data-line-number="31"><span class="co">#&gt; [16] jquerylib_0.1.3      R.oo_1.24.0          R.utils_2.10.1      </span></a>
<a class="sourceLine" id="cb27-32" data-line-number="32"><span class="co">#&gt; [19] S4Vectors_0.28.1     GetoptLong_1.0.5     reticulate_1.18     </span></a>
<a class="sourceLine" id="cb27-33" data-line-number="33"><span class="co">#&gt; [22] rmarkdown_2.7        labeling_0.4.2       stringr_1.4.0       </span></a>
<a class="sourceLine" id="cb27-34" data-line-number="34"><span class="co">#&gt; [25] munsell_0.5.0        compiler_4.0.4       xfun_0.20           </span></a>
<a class="sourceLine" id="cb27-35" data-line-number="35"><span class="co">#&gt; [28] pkgconfig_2.0.3      BiocGenerics_0.36.0  shape_1.4.5         </span></a>
<a class="sourceLine" id="cb27-36" data-line-number="36"><span class="co">#&gt; [31] htmltools_0.5.1.1    tidyselect_1.1.0     tibble_3.0.6        </span></a>
<a class="sourceLine" id="cb27-37" data-line-number="37"><span class="co">#&gt; [34] IRanges_2.24.1       matrixStats_0.58.0   withr_2.4.1         </span></a>
<a class="sourceLine" id="cb27-38" data-line-number="38"><span class="co">#&gt; [37] crayon_1.4.0         dplyr_1.0.4          R.methodsS3_1.8.1   </span></a>
<a class="sourceLine" id="cb27-39" data-line-number="39"><span class="co">#&gt; [40] rappdirs_0.3.3       basilisk.utils_1.2.2 grid_4.0.4          </span></a>
<a class="sourceLine" id="cb27-40" data-line-number="40"><span class="co">#&gt; [43] jsonlite_1.7.2       gtable_0.3.0         lifecycle_0.2.0     </span></a>
<a class="sourceLine" id="cb27-41" data-line-number="41"><span class="co">#&gt; [46] DBI_1.1.1            magrittr_2.0.1       scales_1.1.1        </span></a>
<a class="sourceLine" id="cb27-42" data-line-number="42"><span class="co">#&gt; [49] stringi_1.5.3        farver_2.0.3         bslib_0.2.4         </span></a>
<a class="sourceLine" id="cb27-43" data-line-number="43"><span class="co">#&gt; [52] ellipsis_0.3.1       filelock_1.0.2       generics_0.1.0      </span></a>
<a class="sourceLine" id="cb27-44" data-line-number="44"><span class="co">#&gt; [55] vctrs_0.3.6          cowplot_1.1.1        rjson_0.2.20        </span></a>
<a class="sourceLine" id="cb27-45" data-line-number="45"><span class="co">#&gt; [58] RColorBrewer_1.1-2   tools_4.0.4          Cairo_1.5-12.2      </span></a>
<a class="sourceLine" id="cb27-46" data-line-number="46"><span class="co">#&gt; [61] glue_1.4.2           purrr_0.3.4          parallel_4.0.4      </span></a>
<a class="sourceLine" id="cb27-47" data-line-number="47"><span class="co">#&gt; [64] yaml_2.2.1           clue_0.3-58          colorspace_2.0-0    </span></a>
<a class="sourceLine" id="cb27-48" data-line-number="48"><span class="co">#&gt; [67] cluster_2.1.1        ComplexHeatmap_2.6.2 knitr_1.31          </span></a>
<a class="sourceLine" id="cb27-49" data-line-number="49"><span class="co">#&gt; [70] sass_0.3.1</span></a></code></pre></div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
